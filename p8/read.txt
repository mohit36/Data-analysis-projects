        if msg_count > 4:
            needs_contact = not (
                isinstance(parsed_json, dict) and "contact" in parsed_json
            )

            if needs_contact:
                contact_payload = {
                    "contact": "How can I contact Exigotech sales team?"
                }

                # Ensure we have a dict to work with
                if not isinstance(parsed_json, dict):
                    parsed_json = {}

                parsed_json.update(contact_payload)

                # Update mapping store as well
                service_mapping_store.setdefault(sid, {})
                service_mapping_store[sid]["contact"] = parsed_json["contact"]

                logger.info(
                    "Injected contact payload for sid=%s (msg_count=%s)",
                    sid,
                    msg_count,
                    extra={"service": "api"},
                )

                # ---- Rebuild raw_answer with EXACTLY ONE "Relevant services" block ----
                # Do a case-insensitive search for 'relevant services:'
                lower_text = raw_answer.lower()
                marker = "relevant services:"
                idx = lower_text.find(marker)

                if idx != -1:
                    # Strip everything from the existing marker onwards
                    prefix = raw_answer[:idx].rstrip()
                else:
                    # No existing block, keep full text as prefix
                    prefix = raw_answer.rstrip()

                raw_answer = (
                    f"{prefix}\n\nRelevant services:\n"
                    f"{json.dumps(parsed_json, ensure_ascii=False)}"
                )
