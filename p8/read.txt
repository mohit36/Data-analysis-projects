agent = SearchAgent()
query_intent = await agent.classify_query_type(query)
logger.info("Query intent classified: %s", query_intent)

# --- Track business-oriented intent for contact injection ---
business_intents = {
    "service", "contact", "sales", "pricing", "buy", "business", "quote", "demo"
}

state = service_mapping_store.setdefault(sid, {})
business_count = state.get("business_count", 0)

if isinstance(query_intent, str) and query_intent.lower() in business_intents:
    business_count += 1
    state["business_count"] = business_count
