Good, this is exactly the right moment to clean it up üòé
Let‚Äôs start **systematically** instead of randomly deleting stuff.

I‚Äôll do this in **phases** so you‚Äôre never blind:

1. **Decide the final prompt set (what exists, what dies).**
2. **Today‚Äôs step = give you a clean, optimized block for:**

   * intent classifier
   * query type classifier
   * decontextualization
   * clarification (under-specified + follow-up)
   * greeting + conclusion responses
3. Next step (after you paste this): we‚Äôll simplify all the big answer prompts
   (contact / about / page / case / career + related services JSON).

---

## 1Ô∏è‚É£ Final prompt set I recommend

These are the **only prompts you actually need** long-term:

### A. Classification + orchestration

Keep (we‚Äôll rewrite them):

* `main_intent_classifier`
* `query_type_classification_prompt`
* `query_decontextualization_prompt`
* `clarification_underspecified_prompt`
* `clarification_followup_prompt`

Delete / deprecate:

* old `intent_classification_prompt` (the earlier version above `main_intent_classifier`)
* `trail_query_rewriting_prompt`
* `contextualize_query_rewrite_prompt`
* `llm_contact_label_prompt` (replaced by `micro_llm.py`)
* any other ‚Äúquery rewrite‚Äù / ‚Äútrail rewriting‚Äù prompts you‚Äôre not explicitly calling

### B. Greeting / goodbye

Keep (we‚Äôll rewrite them):

* `greeting_response_prompt`
* `conclusion_response_prompt`

Delete:

* `greeting_and_conclusion_merged_prompt`
* any ‚Äúold_*_prompt‚Äù for greeting/conclusion

### C. RAG answer prompts (we‚Äôll handle in the *next round*)

Keep (to be optimized next):

* `contact_intent_prompt`
* `about_intent_prompt`
* `career_intent_prompt`
* `page_intent_prompt_improved` (or we‚Äôll rename your best one to this)
* `case_intent_prompt`

Delete / deprecate later:

* `contact_old_prompt`, `about_old_prompt`, `career_old_prompt`
* `general_used_to_be_fallback_and_page_prompt`
* other ‚Äúold_*‚Äù variants

---

## 2Ô∏è‚É£ Drop-in replacement: core prompts (paste into prompts.py)

At the **top of `prompts.py`**, add this small config so we don‚Äôt hardcode Exigotech everywhere:

```python
import os

COMPANY_NAME = os.getenv("COMPANY_NAME", "Exigotech")
ASSISTANT_NAME = os.getenv("ASSISTANT_NAME", f"{COMPANY_NAME} AI assistant")
```

Now replace your **current blocks for these prompts** with the ones below.

> ‚úÖ You can safely overwrite the old versions of
> `main_intent_classifier`, `query_type_classification_prompt`,
> `query_decontextualization_prompt`, `clarification_underspecified_prompt`,
> `clarification_followup_prompt`, `greeting_response_prompt`,
> `conclusion_response_prompt`.

---

### A. Intent classifier (greeting/contact/about/page/case/etc.)

```python
main_intent_classifier = f"""
You are a query intent classifier for {COMPANY_NAME}'s website chatbot.

Classify the user query into exactly ONE of these intents:
- greeting
- conclusion
- contact
- about
- career
- page
- case

Definitions (decide based on the MAIN question, not small talk words):

1. greeting
   - Pure greeting or small talk without a clear information request.
   - Examples: "hi", "hello", "hey", "good morning", "how are you?"

2. conclusion
   - User clearly closing the conversation.
   - Examples: "bye", "thank you, that's all", "thanks, I'm done", "no more questions".

3. contact
   - User wants to reach the company or a person at the company OR needs help / support.
   - Includes: pricing, cost, quotes, licensing, renewals, purchases, demos, support, help.
   - Includes queries like "how do I contact you", "can I talk to sales", "support number".
   - If the main focus is getting in touch, classify as contact.

4. about
   - Query about people, roles, team, leadership, departments, or company info.
   - Examples: "who is the CEO", "tell me about your leadership team",
     "what does your company do", "who is in the sales team".

5. career
   - Job applications, hiring, recruitment, internships, positions, interviews.
   - Examples: "open positions", "how can I apply", "careers at your company".

6. page
   - User wants general information about services, solutions, offerings, topics or pages.
   - Examples: "what services do you offer", "show me your cloud services",
     "what are your core offerings", "tell me about your security solutions".

7. case
   - Case studies, success stories, client stories, testimonials, customer results.

Disambiguation rules:
- If the query is mainly about contacting or pricing/support ‚Üí contact.
- If the query is about people, roles, leadership, team ‚Üí about.
- If the query is explicitly about jobs or hiring ‚Üí career.
- If the query is about services/solutions/offerings without clear contact intent ‚Üí page.
- If the query is clearly about case studies or success stories ‚Üí case.
- Greetings together with a real question ‚Üí classify based on the question, NOT greeting.
- Short "thanks" without a new question at the end ‚Üí conclusion.

Return ONLY one word: greeting, conclusion, contact, about, career, page, or case.
No quotes, no explanation, no extra text.
"""
```

---

### B. Query type classifier (standalone / follow_up / under_specified)

```python
query_type_classification_prompt = f"""
You are a query analyzer for {COMPANY_NAME}'s chatbot.

Classify the user query into exactly ONE of these types:

1. "standalone"
   - Query is complete with clear subject and context.
   - Can be answered WITHOUT using previous conversation.
   - Examples:
     - "Who is the CEO of {COMPANY_NAME}?"
     - "What cloud services does {COMPANY_NAME} offer?"
     - "Show me case studies about AI solutions."

2. "follow_up"
   - Query depends on previous conversation or context.
   - Uses pronouns or vague references like "he", "she", "it", "they", "that", "this",
     "those", "the above", "what about that", "the same service".
   - Examples:
     - "How old is he?" (about a person mentioned earlier)
     - "What‚Äôs the pricing for it?" (refers to a service mentioned before)
     - "Can you explain this in more detail?" (refers to previous topic)

3. "under_specified"
   - Query is incomplete or missing key information.
   - No clear reference to earlier conversation (no pronouns that link to history).
   - Too vague to answer accurately as-is.
   - Examples:
     - "How much does it cost?" (no product or service named, no prior context)
     - "Tell me more." (no topic specified)
     - "What are the features?" (no service or product specified)

Classification rules:
- If the query uses pronouns or vague references that clearly rely on previous messages ‚Üí "follow_up".
- Else if the query is clear and specific enough to answer directly ‚Üí "standalone".
- Else ‚Üí "under_specified".

Return ONLY one word: standalone, follow_up, or under_specified.
No explanation, no quotes, no extra text.
"""
```

---

### C. Decontextualization prompt (for follow-ups)

```python
query_decontextualization_prompt = f"""
You are a query decontextualizer for {COMPANY_NAME}'s chatbot.

Your task: rewrite the user's query so it becomes a STANDALONE, COMPLETE question
that can be answered without seeing the previous conversation.

Use:
- The conversation history (previous user questions and assistant replies).
- The current user query.

Rules:
1. Replace pronouns ("he", "she", "it", "they", "this", "that", "these", "those")
   with the correct person, service, topic, or entity from the history.
2. Add missing context (service names, product names, roles, topics) if they are clear
   from previous messages.
3. Preserve the user's original intent and meaning exactly.
4. Do NOT add new facts, services, or assumptions that are not in the history.
5. Keep the rewritten query short and natural, like a normal question.
6. Do not mention that this is a rewrite or that there was history.

History:
{{history}}

User query:
{{query}}

Rewrite the query as a single standalone question.
Return ONLY the rewritten question text, nothing else.
"""
```

> üîß Note: here I used `{history}` / `{query}` as placeholders ‚Äì match whatever format your Python code already uses (if it uses `{history_text}` etc., adjust names but keep the rules).

---

### D. Clarification prompts (under-specified vs follow-up with missing context)

```python
clarification_underspecified_prompt = """
The user asked: "{query}"

This query is too vague or incomplete. Generate ONE polite, specific clarifying
question to understand what they need.

Examples:
- "How much does it cost?" ‚Üí "Which service or product are you asking about?"
- "Tell me more" ‚Üí "What would you like to know more about? We offer cloud services, automation, security, AI solutions, and more."
- "What are the features?" ‚Üí "Which service or solution would you like to know the features of?"

Generate only the clarifying question.
"""

clarification_followup_prompt = """
The user asked: "{query}"

This looks like a follow-up, but you do NOT have enough context to know what it refers to.
Generate ONE polite clarifying question asking them to specify the person, service, or topic.

Examples:
- "How old is he?" ‚Üí "Who are you asking about? Please specify the person's name."
- "What‚Äôs the pricing for it?" ‚Üí "Which service or product are you asking about?"
- "Can you explain this in detail?" ‚Üí "Which part would you like me to explain in more detail?"

Generate only the clarifying question.
"""
```

These are short and focused ‚Üí low token cost, but still give good clarifications.

---

### E. Greeting / conclusion responses (short + strict)

```python
greeting_response_prompt = f"""
You are {ASSISTANT_NAME}. Generate a brief, friendly greeting response.

Structure (do NOT print labels):
1. Short greeting (1 short sentence).
2. One short sentence offering help, mentioning {COMPANY_NAME}.

Constraints:
- Maximum 2 sentences total.
- No links, titles, or contact details.
- No invented facts about {COMPANY_NAME}.

Generate only the greeting text.
"""

conclusion_response_prompt = f"""
You are {ASSISTANT_NAME}. Generate a brief, friendly conclusion response.

Structure (do NOT print labels):
1. Short goodbye (1 short sentence).
2. One short sentence saying the user can come back with more questions later.

Constraints:
- Maximum 2 sentences total.
- No links, titles, or contact details.
- No invented facts about {COMPANY_NAME}.

Generate only the conclusion text.
"""
```

Tiny, predictable, and cheap.

---

## 3Ô∏è‚É£ What to delete *right now*

Once you paste the above:

* You can **delete or comment out** in `prompts.py`:

  * old `intent_classification_prompt`
  * `trail_query_rewriting_prompt`
  * `contextualize_query_rewrite_prompt`
  * `llm_contact_label_prompt`
  * `greeting_and_conclusion_merged_prompt`
  * any `*_old_prompt` that is not used in code any more

(If you‚Äôre unsure whether something is still used, you can `Ctrl+Shift+F` in VS Code and search for the variable name. If nothing references it ‚Üí safe to kill.)

---

## 4Ô∏è‚É£ Next step (after you paste this)

Once this is in and your app still runs, we‚Äôll tackle the **big boys**:

* `contact_intent_prompt`
* `about_intent_prompt`
* `career_intent_prompt`
* `page_intent_prompt_improved` (including the **related services JSON** logic)
* `case_intent_prompt`

There we‚Äôll:

* enforce **one consistent answer structure**
* ensure the last JSON object is **exactly** `{ "Button label": "Follow-up question", ... }`
* trim any repeated ‚Äúessay‚Äù instructions so tokens stay low

When you‚Äôre done pasting this block and it‚Äôs running, just tell me ‚Äúready for answer prompts‚Äù and we‚Äôll surgically rewrite those next.
